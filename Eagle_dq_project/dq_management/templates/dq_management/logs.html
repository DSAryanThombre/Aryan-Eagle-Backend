<!DOCTYPE html>
{% load static %}

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eagle DQ - Logs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* CSS Variables for Theme Colors */
        :root {
            /* Light Theme Colors */
            --bg-primary: linear-gradient(135deg, #fef7ed 0%, #fdf4ff 25%, #f0f9ff 50%, #f0fdfa 75%, #fefce8 100%);
            --bg-overlay: radial-gradient(circle at 20% 80%, rgba(251, 191, 36, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(14, 165, 233, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(139, 92, 246, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 60% 60%, rgba(236, 72, 153, 0.04) 0%, transparent 50%);

            --sidebar-bg: linear-gradient(180deg, rgba(255, 255, 255, 0.95) 0%, rgba(254, 252, 232, 0.9) 50%, rgba(240, 249, 255, 0.9) 100%);
            --sidebar-border: rgba(251, 191, 36, 0.1);
            --sidebar-shadow: 2px 0 20px rgba(251, 191, 36, 0.1);

            --card-bg: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(254, 252, 232, 0.3) 25%, rgba(240, 249, 255, 0.3) 75%, rgba(255, 255, 255, 0.9) 100%);
            --card-border: rgba(251, 191, 36, 0.1);
            --card-shadow: 0 8px 32px rgba(251, 191, 36, 0.08);

            --table-bg: #ffffff;
            --table-border: rgba(148, 163, 184, 0.18);
            --table-header-bg: #8b5cf6;
            --table-header-text: #ffffff;
            --table-header-shadow: 0 4px 8px rgba(139, 92, 246, 0.3);

            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-tertiary: #64748b;
            --text-muted: #94a3b8;
            --text-table: #374151;

            --border-color: #e2e8f0;
            --scrollbar-thumb: rgba(139, 92, 246, 0.3);
            --scrollbar-thumb-hover: rgba(139, 92, 246, 0.6);

            --modal-bg: #ffffff;
            --modal-border: #e2e8f0;
            --modal-body-bg: #f7f7f7;

            --filter-drawer-bg: #ffffff;
            --filter-input-bg: #ffffff;
            --filter-input-border: #e2e8f0;

            --button-bg: #e0f2fe;
            --button-color: #2563eb;
            --button-hover-bg: #2563eb;
            --button-hover-color: #ffffff;

            --no-data-bg: rgba(248, 250, 252, 0.6);
            --no-data-border: rgba(148, 163, 184, 0.25);
        }

        /* Dark Theme Colors */
        [data-theme="dark"] {
            --bg-primary: linear-gradient(135deg, #0f172a 0%, #1e1b4b 25%, #164e63 50%, #134e4a 75%, #365314 100%);
            --bg-overlay: radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(168, 85, 247, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(34, 197, 94, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 60% 60%, rgba(251, 191, 36, 0.04) 0%, transparent 50%);

            --sidebar-bg: linear-gradient(180deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 27, 75, 0.9) 50%, rgba(22, 78, 99, 0.9) 100%);
            --sidebar-border: rgba(59, 130, 246, 0.2);
            --sidebar-shadow: 2px 0 20px rgba(59, 130, 246, 0.15);

            --card-bg: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 27, 75, 0.3) 25%, rgba(22, 78, 99, 0.3) 75%, rgba(15, 23, 42, 0.9) 100%);
            --card-border: rgba(59, 130, 246, 0.2);
            --card-shadow: 0 8px 32px rgba(59, 130, 246, 0.15);

            --table-bg: rgba(15, 23, 42, 0.95);
            --table-border: rgba(59, 130, 246, 0.25);
            --table-header-bg: linear-gradient(135deg, #4c1d95 0%, #5b21b6 50%, #6d28d9 100%);
            --table-header-text: #f8fafc;
            --table-header-shadow: 0 4px 8px rgba(139, 92, 246, 0.4);

            --text-primary: #f8fafc;
            --text-secondary: #e2e8f0;
            --text-tertiary: #cbd5e1;
            --text-muted: #94a3b8;
            --text-table: #e2e8f0;

            --border-color: rgba(59, 130, 246, 0.2);
            --scrollbar-thumb: rgba(59, 130, 246, 0.4);
            --scrollbar-thumb-hover: rgba(59, 130, 246, 0.7);

            --modal-bg: rgba(15, 23, 42, 0.95);
            --modal-border: rgba(59, 130, 246, 0.3);
            --modal-body-bg: rgba(30, 27, 75, 0.8);

            --filter-drawer-bg: rgba(15, 23, 42, 0.95);
            --filter-input-bg: rgba(30, 27, 75, 0.6);
            --filter-input-border: rgba(59, 130, 246, 0.3);

            --button-bg: rgba(59, 130, 246, 0.2);
            --button-color: #93c5fd;
            --button-hover-bg: rgba(59, 130, 246, 0.4);
            --button-hover-color: #f8fafc;

            --no-data-bg: rgba(15, 23, 42, 0.6);
            --no-data-border: rgba(59, 130, 246, 0.25);
        }

        body {
            display: flex;
            min-height: 100vh;
            background: var(--bg-primary);
            font-family: 'Inter', sans-serif;
            margin: 0;
            position: relative;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: var(--bg-overlay);
            pointer-events: none;
            z-index: -1;
            transition: all 0.3s ease;
        }

        /* Table and cell styling with dark mode support */
        th,
        td {
            padding: 0.2rem 0.6rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.8125rem;
            position: relative;
            color: var(--text-table);
            transition: all 0.3s ease;
        }

        th {
            color: var(--table-header-text);
            font-weight: 600;
        }

        /* Enhanced scrollbar styling */
        .scrollable-table-container::-webkit-scrollbar,
        .modal-body::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        .scrollable-table-container::-webkit-scrollbar-thumb,
        .modal-body::-webkit-scrollbar-thumb {
            background-color: var(--scrollbar-thumb);
            border-radius: 10px;
            transition: background-color 0.3s ease;
        }

        .scrollable-table-container::-webkit-scrollbar-thumb:hover,
        .modal-body::-webkit-scrollbar-thumb:hover {
            background-color: var(--scrollbar-thumb-hover);
        }

        .scrollable-table-container::-webkit-scrollbar-track,
        .modal-body::-webkit-scrollbar-track {
            background: transparent;
        }

        .query-wrapper {
            white-space: normal;
            word-break: break-all;
            font-size: 0.75rem;
            position: relative;
            max-height: 6.25em;
            overflow: hidden;
            margin: 0;
            line-height: 1.25;
            color: var(--text-table);
            transition: color 0.3s ease;
        }

        .message-wrapper {
            white-space: normal;
            word-break: break-word;
            font-size: 0.75rem;
            position: relative;
            max-height: 3.75em;
            overflow: hidden;
            margin: 0;
            line-height: 1.25;
            color: var(--text-table);
            transition: color 0.3s ease;
        }

        .results-details-display {
            display: flex;
            flex-direction: column;
            gap: 1px;
            padding: 2px 0;
        }

        .results-detail-item {
            font-size: 0.75rem;
            color: var(--text-table);
            display: flex;
            align-items: center;
            gap: 4px;
            transition: color 0.3s ease;
        }

        .results-detail-item strong {
            color: var(--text-primary);
            font-weight: 500;
        }

        .view-details-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #3b82f6;
            cursor: pointer;
            font-size: 0.75rem;
            margin-top: 4px;
            font-weight: 500;
            transition: color 0.15s;
        }

        .view-details-btn:hover {
            color: #1d4ed8;
        }

        [data-theme="dark"] .view-details-btn {
            color: #60a5fa;
        }

        [data-theme="dark"] .view-details-btn:hover {
            color: #93c5fd;
        }

        /* Enhanced modal styling */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: var(--modal-bg);
            border-radius: 0.75rem;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--modal-border);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            transition: all 0.3s ease;
        }

        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--modal-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--modal-bg);
        }

        .modal-header h3 {
            color: var(--text-primary);
            margin: 0;
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
            flex-grow: 1;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.875rem;
            background: var(--modal-body-bg);
            white-space: pre-wrap;
            word-break: break-all;
            color: var(--text-table);
        }

        .modal-body pre {
            white-space: pre-wrap;
            word-break: break-all;
            margin: 0;
            padding: 0;
            color: var(--text-table);
        }

        /* Enhanced table container */
        .scrollable-table-container {
            height: calc(100vh - 8.5rem);
            overflow-y: auto;
            overflow-x: auto;
            border: 1px solid var(--table-border);
            border-radius: 0.5rem;
            background: var(--table-bg);
            padding: 0.25rem;
            flex-grow: 1;
            padding-bottom: 0;
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            transition: all 0.3s ease;
        }

        /* Enhanced table header */
        thead {
            position: sticky;
            top: 0;
            z-index: 20;
            background: var(--table-header-bg);
            box-shadow: var(--table-header-shadow);
            border-radius: 0.5rem 0.5rem 0 0;
            overflow: hidden;
        }

        #caseTable,
        #groupTable,
        #projectTable {
            border-collapse: separate;
            border-spacing: 0;
            background: var(--table-bg);
            transition: background 0.3s ease;
        }

        thead th:first-child {
            border-top-left-radius: 0.5rem;
        }

        thead th:last-child {
            border-top-right-radius: 0.5rem;
        }

        .resize-handle {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            width: 8px;
            cursor: col-resize;
            z-index: 40;
            opacity: 1;
            background-color: rgba(255, 255, 255, 0.3);
            transition: background-color 0.1s;
        }

        .resize-handle:hover {
            opacity: 1;
            background-color: rgba(255, 255, 255, 0.7);
        }

        [data-theme="dark"] .resize-handle {
            background-color: rgba(59, 130, 246, 0.3);
        }

        [data-theme="dark"] .resize-handle:hover {
            background-color: rgba(59, 130, 246, 0.6);
        }

        /* Enhanced status badges */
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 999px;
            font-size: 0.6875rem;
            font-weight: 600;
            letter-spacing: 0.01em;
            transition: all 0.3s ease;
        }

        .status-pass {
            background: linear-gradient(90deg, #065f46, #047857);
            color: #6ee7b7;
            border: 1px solid #059669;
        }

        .status-fail {
            background: linear-gradient(90deg, #7f1d1d, #991b1b);
            color: #fca5a5;
            border: 1px solid #b91c1c;
        }

        .status-error {
            background: linear-gradient(90deg, #78350f, #92400e);
            color: #fcd34d;
            border: 1px solid #b45309;
        }

        .status-default {
            background: var(--table-bg);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        [data-theme="light"] .status-pass {
            background: linear-gradient(90deg, #ecfdf5, #d1fae5);
            color: #047857;
            border: 1px solid #a7f3d0;
        }

        [data-theme="light"] .status-fail {
            background: linear-gradient(90deg, #fef2f2, #fecaca);
            color: #b91c1c;
            border: 1px solid #f87171;
        }

        [data-theme="light"] .status-error {
            background: linear-gradient(90deg, #fffbeb, #fde68a);
            color: #b45309;
            border: 1px solid #f59e0b;
        }

        [data-theme="light"] .status-default {
            background: linear-gradient(90deg, #f1f5f9, #e2e8f0);
            color: #475569;
            border: 1px solid #cbd5e1;
        }

        /* Enhanced button styling */
        #sidebarToggleBtn {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            z-index: 50;
            width: 40px;
            height: 40px;
            background: var(--button-bg);
            color: var(--button-color);
            border: none;
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
        }

        #sidebarToggleBtn:hover {
            background: var(--button-hover-bg);
            color: var(--button-hover-color);
            transform: scale(1.05);
        }

        #filtersToggleBtn {
            position: fixed;
            top: 1rem;
            right: 4rem;
            z-index: 50;
            width: 44px;
            height: 44px;
            background: var(--button-bg);
            color: var(--button-color);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(20px);
        }

        #filtersToggleBtn:hover {
            background: var(--button-hover-bg);
            color: var(--button-hover-color);
            transform: scale(1.05);
        }

        /* Dark Mode Toggle Button */
        .dark-mode-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 50;
            background: var(--button-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            color: var(--button-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dark-mode-toggle:hover {
            transform: scale(1.1);
            background: var(--button-hover-bg);
            color: var(--button-hover-color);
        }

        .dark-mode-toggle i {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .dark-mode-toggle:hover i {
            transform: rotate(180deg);
        }

        /* Enhanced filter drawer */
        #filtersDrawer {
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            width: 320px;
            background: var(--filter-drawer-bg);
            backdrop-filter: blur(20px);
            box-shadow: -2px 0 25px rgba(0, 0, 0, 0.15);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 60;
            border-left: 1px solid var(--border-color);
        }

        #filtersDrawer.open {
            transform: translateX(0);
        }

        #filtersDrawer label {
            color: var(--text-secondary);
        }

        #filtersDrawer input,
        #filtersDrawer select {
            background: var(--filter-input-bg);
            border: 1px solid var(--filter-input-border);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        #filtersDrawer input:focus,
        #filtersDrawer select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }

        #filtersDrawer button {
            transition: all 0.3s ease;
        }

        #filtersDrawer .font-semibold {
            color: var(--text-primary);
        }

        #filtersCloseBtn {
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.3s ease;
        }

        #filtersCloseBtn:hover {
            color: var(--text-primary);
        }

        /* Enhanced main content */
        .main-content-wrapper {
            flex-grow: 1;
            padding: 1.5rem;
            height: 100vh;
            overflow-y: auto;
            transition: margin-left 0.3s ease;
            margin-left: 280px;
        }

        .main-content-card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--card-border);
            height: calc(100% - 3rem);
            display: flex;
            flex-direction: column;
            flex-grow: 1;
            transition: all 0.3s ease;
        }

        .log-content {
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        /* Enhanced no-data styling */
        .no-data {
            margin: 1.25rem auto;
            max-width: 48rem;
            border: 1px dashed var(--no-data-border);
            border-radius: 0.75rem;
            padding: 1rem;
            text-align: center;
            color: var(--text-secondary);
            background: var(--no-data-bg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            justify-content: center;
            transition: all 0.3s ease;
        }

        /* Table row hover effects */
        tbody tr {
            transition: background-color 0.2s ease;
        }

        tbody tr:hover {
            background-color: rgba(59, 130, 246, 0.05);
        }

        [data-theme="dark"] tbody tr:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }

        /* Enhanced draggable headers */
        th[draggable="true"] {
            cursor: grab;
            user-select: none;
        }

        th[draggable="true"]:active {
            cursor: grabbing;
        }

        th[draggable="true"]:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .main-content-wrapper {
                margin-left: 260px;
            }

            .dark-mode-toggle {
                top: 0.5rem;
                right: 0.5rem;
                width: 40px;
                height: 40px;
            }

            #filtersToggleBtn {
                top: 0.5rem;
                right: 3rem;
                width: 40px;
                height: 40px;
            }
        }

        @media (max-width: 640px) {
            .message-cell {
                max-width: 14rem;
            }
        }
    </style>
</head>

<body>
    {% include 'dq_management/includes/sidebar.html' %}

    <button id="sidebarToggleBtn"
        class="fixed bottom-4 left-4 z-50 rounded-full p-2 shadow-lg focus:outline-none transition-all duration-300 flex items-center justify-center"
        style="width: 40px; height: 40px;">
        <span id="sidebarToggleIcon" style="font-size: 1.5rem;">
            <i class="fas fa-angle-left"></i>
        </span>
    </button>

    <div id="mainContent" class="main-content-wrapper transition-all duration-300">
        <div class="main-content-card">

            <div id="tab-case-content" class="log-content">
                <div class="scrollable-table-container">
                    <table id="caseTable" class="min-w-full shadow-sm" style="table-layout: fixed;">
                        <colgroup>
                            <col style="width: 80px;">
                            <col style="width: 120px;">
                            <col style="width: 80px;">
                            <col style="width: 150px;">
                            <col style="width: 100px;">
                            <col style="width: 150px;">
                            <col style="width: 120px;">
                            <col style="width: 80px;">
                            <col style="width: 300px;">
                            <col style="width: 100px;">
                            <col style="width: 100px;">
                            <col style="width: 80px;">
                            <col style="width: 120px;">
                            <col style="width: 120px;">
                            <col style="width: 400px;">
                            <col style="width: 400px;">
                            <col style="width: 100px;">
                            <col style="width: 100px;">
                            <col style="width: 120px;">
                            <col style="width: 120px;">
                            <col style="width: 120px;">
                            <col style="width: 120px;">
                            <col style="width: 200px;">
                        </colgroup>
                        <thead>
                            <tr>
                                <th draggable="true">Run ID<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Test Case ID<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Project ID<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Project Name<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Test Name<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Test Type<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Status<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Message<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Source Value<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Destination Value<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Difference<div
                                        class```html:Eagle_dq_project\dq_management\templates\dq_management\logs.html="resize-handle">
                                    </div>
                                </th>
                                <th draggable="true">Threshold Type<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Threshold Value<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Source Query<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Destination Query<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Source Conn<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Dest Conn<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Parent Run ID<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Run Timestamp<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Criticality<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Possible Resolution<div class="resize-handle"></div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in test_case_logs %}
                            <tr>
                                <td class="text-xs">{{ log.run_id }}</td>
                                <td class="text-xs">{{ log.test_case_id }}</td>
                                <td class="text-xs">{{ log.project_id }}</td>
                                <td class="text-xs">{{ log.project_name|default:"N/A" }}</td>
                                <td class="text-xs">{{ log.test_name }}</td>
                                <td class="text-xs">{{ log.test_type }}</td>
                                <td class="text-xs">
                                    {% with status=log.run_status|stringformat:"s"|upper %}
                                    {% if status %}
                                    {% if status == "PASS" %}
                                    <span class="status-badge status-pass">{{ status }}</span>
                                    {% elif status == "ERROR" %}
                                    <span class="status-badge status-error">{{ status }}</span>
                                    {% elif status == "FAIL" %}
                                    <span class="status-badge status-fail">{{ status }}</span>
                                    {% else %}
                                    <span class="status-badge status-default">{{ status }}</span>
                                    {% endif %}
                                    {% else %}
                                    <span class="status-badge status-default">N/A</span>
                                    {% endif %}
                                    {% endwith %}
                                </td>

                                <td class="text-xs message-cell">
                                    <div class="message-wrapper">{{ log.run_message }}</div>
                                    <button class="view-details-btn"
                                        onclick="openModal('Run Message', 'Message Details', '{{ log.run_message|escapejs }}')">
                                        View Details <i class="fas fa-search-plus"></i>
                                    </button>
                                </td>

                                <td class="text-xs">{{ log.source_value }}</td>
                                <td class="text-xs">{{ log.destination_value }}</td>
                                <td class="text-xs">{{ log.difference }}</td>
                                <td class="text-xs">{{ log.threshold_type|default:"N/A" }}</td>
                                <td class="text-xs">{{ log.threshold_value|default:"N/A" }}</td>

                                <td class="text-xs">
                                    <div class="query-wrapper">{{ log.source_query }}</div>
                                    <button class="view-details-btn"
                                        onclick="openModal('Query Details', 'Source Query', '{{ log.source_query|escapejs }}')">
                                        View Query <i class="fas fa-search-plus"></i>
                                    </button>
                                </td>

                                <td class="text-xs">
                                    <div class="query-wrapper">{{ log.destination_query }}</div>
                                    <button class="view-details-btn"
                                        onclick="openModal('Query Details', 'Destination Query', '{{ log.destination_query|escapejs }}')">
                                        View Query <i class="fas fa-search-plus"></i>
                                    </button>
                                </td>

                                <td class="text-xs">{{ log.source_connection_used }}</td>
                                <td class="text-xs">{{ log.destination_connection_used }}</td>
                                <td class="text-xs">{{ log.parent_run_id|default:'N/A' }}</td>
                                <td class="text-xs">{{ log.run_timestamp|date:"Y-m-d H:i:s"|default:"N/A" }}</td>
                                <td class="text-xs">{{ log.criticality|default:"N/A" }}</td>
                                <td class="text-xs">
                                    <div class="message-wrapper">{{ log.possible_resolution }}</div>
                                    <button class="view-details-btn"
                                        onclick="openModal('Possible Resolution', 'Resolution Details', '{{ log.possible_resolution|escapejs }}')">
                                        View Details <i class="fas fa-search-plus"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% if not test_case_logs %}
                <div class="no-data">
                    <span style="font-size:1.25rem;color:#2563eb;"><i class="fas fa-inbox"></i></span>
                    <span>No test case logs found yet.</span>
                </div>
                {% endif %}
            </div>

            <div id="tab-group-content" class="log-content" style="display:none;">
                <div class="scrollable-table-container">
                    <table id="groupTable" class="min-w-full shadow-sm" style="table-layout: fixed;">
                        <colgroup>
                            <col style="width: 100px;">
                            <col style="width: 120px;">
                            <col style="width: 150px;">
                            <col style="width: 150px;">
                            <col style="width: 80px;">
                            <col style="width: 300px;">
                            <col style="width: 450px;">
                            <col style="width: 200px;">
                            <col style="width: 200px;">
                            <col style="width: 120px;">
                        </colgroup>
                        <thead>
                            <tr>
                                <th draggable="true">Run ID<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Test Group ID<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Project Name<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Group Name<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Status<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Message<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Results Details<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Start Time<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">End Time<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Criticality<div class="resize-handle"></div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in test_group_logs %}
                            <tr>
                                <td class="text-xs">{{ log.run_id }}</td>
                                <td class="text-xs">{{ log.test_group_id }}</td>
                                <td class="text-xs">{{ log.project_name|default:"N/A" }}</td>
                                <td class="text-xs">{{ log.group_name|default:"N/A" }}</td>
                                <td>
                                    {% with status=log.status|stringformat:"s"|upper %}
                                    {% if status %}
                                    {% if status == "PASS" %}
                                    <span class="status-badge status-pass">{{ status }}</span>
                                    {% elif status == "FAIL" %}
                                    <span class="status-badge status-fail">{{ status }}</span>
                                    {% elif status == "ERROR" %}
                                    <span class="status-badge status-error">{{ status }}</span>
                                    {% else %}
                                    <span class="status-badge status-default">{{ status }}</span>
                                    {% endif %}
                                    {% else %}
                                    <span class="status-badge status-default">N/A</span>
                                    {% endif %}
                                    {% endwith %}
                                </td>

                                <td class="text-sm message-cell">
                                    <div class="message-wrapper">{{ log.message }}</div>
                                    <button class="view-details-btn"
                                        onclick="openModal('Group Message', 'Message Details', '{{ log.message|escapejs }}')">
                                        View Details <i class="fas fa-search-plus"></i>
                                    </button>
                                </td>

                                <td>
                                    <div id="details-{{ log.run_id }}" class="results-details-display">
                                    </div>
                                    <button class="view-details-btn"
                                        onclick="openModal('Results Details', 'Full JSON Details', '{{ log.results_details|escapejs }}')">
                                        View Details <i class="fas fa-search-plus"></i>
                                    </button>
                                </td>

                                <td class="text-xs">{{ log.start_timestamp|date:"Y-m-d H:i:s"|default:"N/A" }}</td>
                                <td class="text-xs">{{ log.end_timestamp|date:"Y-m-d H:i:s"|default:"N/A" }}</td>
                                <td class="text-xs">{{ log.criticality|default:"N/A" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% if not test_group_logs %}
                <div class="no-data">
                    <span style="font-size:1.25rem;color:#2563eb;"><i class="fas fa-inbox"></i></span>
                    <span>No test group logs found yet.</span>
                </div>
                {% endif %}
            </div>

            <div id="tab-project-content" class="log-content" style="display:none;">
                <div class="scrollable-table-container">
                    <table id="projectTable" class="min-w-full shadow-sm" style="table-layout: fixed;">
                        <colgroup>
                            <col style="width: 100px;">
                            <col style="width: 120px;">
                            <col style="width: 150px;">
                            <col style="width: 80px;">
                            <col style="width: 300px;">
                            <col style="width: 450px;">
                            <col style="width: 200px;">
                            <col style="width: 200px;">
                            <col style="width: 120px;">
                            <col style="width: 120px;">
                        </colgroup>
                        <thead>
                            <tr>
                                <th draggable="true">Run ID<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Project ID<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Project Name<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Status<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Message<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Results Details<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Start Time<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">End Time<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Criticality<div class="resize-handle"></div>
                                </th>
                                <th draggable="true">Execution Type<div class="resize-handle"></div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in project_logs %}
                            <tr>
                                <td class="text-xs">{{ log.run_id }}</td>
                                <td class="text-xs">{{ log.project_id }}</td>
                                <td class="text-xs">{{ log.project_name|default:"N/A" }}</td>
                                <td>
                                    {% with status=log.status|stringformat:"s"|upper %}
                                    {% if status %}
                                    {% if status == "PASS" %}
                                    <span class="status-badge status-pass">{{ status }}</span>
                                    {% elif status == "FAIL" %}
                                    <span class="status-badge status-fail">{{ status }}</span>
                                    {% elif status == "ERROR" %}
                                    <span class="status-badge status-error">{{ status }}</span>
                                    {% else %}
                                    <span class="status-badge status-default">{{ status }}</span>
                                    {% endif %}
                                    {% else %}
                                    <span class="status-badge status-default">N/A</span>
                                    {% endif %}
                                    {% endwith %}
                                </td>
                                <td class="text-sm message-cell">
                                    <div class="message-wrapper">{{ log.message }}</div>
                                    <button class="view-details-btn"
                                        onclick="openModal('Project Message', 'Message Details', '{{ log.message|escapejs }}')">
                                        View Details <i class="fas fa-search-plus"></i>
                                    </button>
                                </td>
                                <td>
                                    <div id="project-details-{{ log.run_id }}" class="results-details-display">
                                    </div>
                                    <button class="view-details-btn"
                                        onclick="openModal('Results Details', 'Full JSON Details', '{{ log.results_details|escapejs }}')">
                                        View Details <i class="fas fa-search-plus"></i>
                                    </button>
                                </td>
                                <td class="text-xs">{{ log.start_timestamp|date:"Y-m-d H:i:s"|default:"N/A" }}</td>
                                <td class="text-xs">{{ log.end_timestamp|date:"Y-m-d H:i:s"|default:"N/A" }}</td>
                                <td class="text-xs">{{ log.criticality|default:"N/A" }}</td>
                                <td class="text-xs">{{ log.execution_type|default:"N/A" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>

                {% if not project_logs %}
                <div class="no-data">
                    <span style="font-size:1.25rem;color:#2563eb;"><i class="fas fa-inbox"></i></span>
                    <span>No project logs found yet.</span>
                </div>
                {% endif %}
            </div>

        </div>
    </div>

    <button id="filtersToggleBtn"
        class="fixed top-6 z-50 rounded-full p-2 shadow-lg focus:outline-none transition-all duration-300 flex items-center justify-center border"
        style="width: 44px; height: 44px;">
        <span style="font-size: 1.5rem;">
            <i class="fas fa-filter"></i>
        </span>
    </button>

    <div id="filtersDrawer" class="fixed top-0 right-0 h-full w-80 shadow-xl z-50 transition-transform duration-300"
        style="transform: translateX(100%); max-width: 100vw; overflow-y: auto;">
        <div class="flex justify-between items-center px-6 py-4 border-b">
            <span class="font-semibold text-lg">Filters</span>
            <button id="filtersCloseBtn" class="text-2xl focus:outline-none">
                Ã—
            </button>
        </div>
        <div class="px-6 py-4 space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1">Project ID</label>
                <input type="text" id="filterProjectId" class="w-full border rounded px-3 py-2 text-sm"
                    placeholder="Project ID">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Test Group ID</label>
                <input type="text" id="filterTestGroupId" class="w-full border rounded px-3 py-2 text-sm"
                    placeholder="Test Group ID">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Test Case ID</label>
                <input type="text" id="filterTestCaseId" class="w-full border rounded px-3 py-2 text-sm"
                    placeholder="Test Case ID">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Status</label>
                <select id="filterStatus" class="w-full border rounded px-3 py-2 text-sm">
                    <option value="">Any</option>
                    <option value="pass">PASS</option>
                    <option value="fail">FAIL</option>
                    <option value="error">ERROR</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Test Type</label>
                <select id="filterTestType" class="w-full border rounded px-3 py-2 text-sm">
                    <option value="">Any</option>
                    <option value="availability test">Availability Test</option>
                    <option value="aggregation comparison">Aggregation Comparison</option>
                    <option value="drift test">Drift Test</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Parent Run ID</label>
                <input type="text" id="filterParentRunId" class="w-full border rounded px-3 py-2 text-sm"
                    placeholder="Parent Run ID">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1">Run ID</label>
                <input type="text" id="filterRunId" class="w-full border rounded px-3 py-2 text-sm"
                    placeholder="Run ID">
            </div>
            <button id="applyFiltersBtn"
                class="w-full bg-blue-600 text-white py-2 rounded font-semibold mt-2 hover:bg-blue-700 transition-colors">Apply
                Filters</button>
            <button id="clearFiltersBtn"
                class="w-full bg-gray-200 text-gray-700 py-2 rounded font-semibold mt-2 hover:bg-gray-300 transition-colors">Clear
                All</button>
        </div>
    </div>

    <div id="dataModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle" class="font-bold text-xl"></h3>
                <button id="modalCloseBtn" class="text-2xl focus:outline-none hover:opacity-70 transition-opacity">
                    &times;
                </button>
            </div>
            <div id="modalBody" class="modal-body">
            </div>
        </div>
    </div>

    <script>
        // Theme Management System - Listen for sidebar theme changes
        document.addEventListener('DOMContentLoaded', function () {
            // Get saved theme or default to light
            const savedTheme = localStorage.getItem('eagle-dq-theme') || 'light';

            // Apply theme on page load
            function applyTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
            }

            // Initialize theme
            applyTheme(savedTheme);

            // Listen for theme changes from sidebar
            window.addEventListener('themeChanged', function(e) {
                const theme = e.detail.theme;
                applyTheme(theme);
            });
        });

        // Sidebar toggle logic
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const toggleBtn = document.getElementById('sidebarToggleBtn');
        const toggleIcon = document.getElementById('sidebarToggleIcon');
        let sidebarVisible = true;

        function getSidebarWidth() {
            return (sidebar && sidebar.offsetWidth) ? sidebar.offsetWidth : 280;
        }

        function hideSidebar() {
            if (!sidebar) return;
            const w = getSidebarWidth();
            sidebar.style.marginLeft = `-${w}px`;
            mainContent.style.marginLeft = '0';
            toggleIcon.innerHTML = '<i class="fas fa-angle-right"></i>';
            sidebarVisible = false;
        }

        function showSidebar() {
            if (!sidebar) return;
            const w = getSidebarWidth();
            sidebar.style.marginLeft = '0';
            mainContent.style.marginLeft = `${w}px`;
            toggleIcon.innerHTML = '<i class="fas fa-angle-left"></i>';
            sidebarVisible = true;
        }

        toggleBtn.addEventListener('click', function () {
            if (sidebarVisible) hideSidebar();
            else showSidebar();
        });

        // Filters drawer logic
        const filtersToggleBtn = document.getElementById('filtersToggleBtn');
        const filtersDrawer = document.getElementById('filtersDrawer');
        const filtersCloseBtn = document.getElementById('filtersCloseBtn');
        const applyFiltersBtn = document.getElementById('applyFiltersBtn');
        const clearFiltersBtn = document.getElementById('clearFiltersBtn');

        filtersToggleBtn.addEventListener('click', function () {
            filtersDrawer.style.transform = 'translateX(0)';
            document.body.style.overflow = 'hidden';
        });

        filtersCloseBtn.addEventListener('click', function () {
            filtersDrawer.style.transform = 'translateX(100%)';
            document.body.style.overflow = '';
        });

        // Helper function to create a column header to index map
        function getColumnIndexMap(tableId) {
            const table = document.getElementById(tableId);
            if (!table) return null;
            const headers = Array.from(table.querySelector('thead tr').children);
            const map = {};
            headers.forEach((th, index) => {
                const headerText = th.textContent.trim().toLowerCase().replace(/ /g, '');
                map[headerText] = index;
            });
            return map;
        }

        // Helper function to get the text content of a specific cell in a row
        function getCellContent(row, map, columnName) {
            const index = map[columnName.toLowerCase().replace(/ /g, '')];
            if (index !== undefined && row.children[index]) {
                if (columnName === 'Status') {
                    const badge = row.children[index].querySelector('.status-badge');
                    return badge ? badge.textContent.trim().toLowerCase() : '';
                }
                return row.children[index].textContent.trim().toLowerCase();
            }
            return '';
        }

        applyFiltersBtn.addEventListener('click', function () {
            const projectId = document.getElementById('filterProjectId').value.toLowerCase();
            const testGroupId = document.getElementById('filterTestGroupId').value.toLowerCase();
            const testCaseId = document.getElementById('filterTestCaseId').value.toLowerCase();
            const status = document.getElementById('filterStatus').value.toLowerCase();
            const testType = document.getElementById('filterTestType').value.toLowerCase();
            const parentRunId = document.getElementById('filterParentRunId').value.toLowerCase();
            const runId = document.getElementById('filterRunId').value.toLowerCase();

            const caseContent = document.getElementById('tab-case-content');
            const groupContent = document.getElementById('tab-group-content');
            const projectContent = document.getElementById('tab-project-content');
            let currentTab = 'case';

            if (groupContent.style.display !== 'none') {
                currentTab = 'group';
            } else if (projectContent.style.display !== 'none') {
                currentTab = 'project';
            }

            if (currentTab === 'case') {
                const map = getColumnIndexMap('caseTable');
                if (!map) return;

                document.querySelectorAll('#tab-case-content tbody tr').forEach(row => {
                    const rowRunId = getCellContent(row, map, 'Run ID');
                    const rowTestCaseId = getCellContent(row, map, 'Test Case ID');
                    const rowProjectId = getCellContent(row, map, 'Project ID');
                    const rowStatus = getCellContent(row, map, 'Status');
                    const rowTestType = getCellContent(row, map, 'Test Type');
                    const rowParentRunId = getCellContent(row, map, 'Parent Run ID');

                    const matches =
                        (projectId === '' || rowProjectId.includes(projectId)) &&
                        (testCaseId === '' || rowTestCaseId.includes(testCaseId)) &&
                        (status === '' || rowStatus === status) &&
                        (testType === '' || rowTestType.includes(testType)) &&
                        (parentRunId === '' || rowParentRunId.includes(parentRunId)) &&
                        (runId === '' || rowRunId.includes(runId));

                    row.style.display = matches ? '' : 'none';
                });

            } else if (currentTab === 'group') {
                const map = getColumnIndexMap('groupTable');
                if (!map) return;

                document.querySelectorAll('#tab-group-content tbody tr').forEach(row => {
                    const rowRunId = getCellContent(row, map, 'Run ID');
                    const rowTestGroupId = getCellContent(row, map, 'Test Group ID');
                    const rowStatus = getCellContent(row, map, 'Status');

                    const matches =
                        (testGroupId === '' || rowTestGroupId.includes(testGroupId)) &&
                        (status === '' || rowStatus === status) &&
                        (runId === '' || rowRunId.includes(runId));

                    row.style.display = matches ? '' : 'none';
                });

            } else if (currentTab === 'project') {
                const map = getColumnIndexMap('projectTable');
                if (!map) return;

                document.querySelectorAll('#tab-project-content tbody tr').forEach(row => {
                    const rowRunId = getCellContent(row, map, 'Run ID');
                    const rowProjectId = getCellContent(row, map, 'Project ID');
                    const rowStatus = getCellContent(row, map, 'Status');

                    const matches =
                        (projectId === '' || rowProjectId.includes(projectId)) &&
                        (status === '' || rowStatus === status) &&
                        (runId === '' || rowRunId.includes(runId));

                    row.style.display = matches ? '' : 'none';
                });
            }

            filtersDrawer.style.transform = 'translateX(100%)';
            document.body.style.overflow = '';
        });

        clearFiltersBtn.addEventListener('click', function () {
            ['filterProjectId', 'filterTestGroupId', 'filterTestCaseId', 'filterStatus', 'filterTestType', 'filterParentRunId', 'filterRunId']
                .forEach(id => document.getElementById(id).value = '');

            document.querySelectorAll('.log-content tbody tr').forEach(row => row.style.display = '');

            filtersDrawer.style.transform = 'translateX(100%)';
            document.body.style.overflow = '';
        });

        function getUrlParam(name) {
            const params = new URLSearchParams(window.location.search);
            return params.get(name);
        }

        // Function to open the modal with content
        function openModal(title, subtitle, content) {
            const modal = document.getElementById('dataModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');

            let formattedContent = content;
            let finalTitle = subtitle;
            try {
                let cleanedContent = content.startsWith('"') && content.endsWith('"') ? content.slice(1, -1) : content;
                const json = JSON.parse(cleanedContent);
                formattedContent = JSON.stringify(json, null, 2);
                finalTitle = `${title} (${subtitle})`;
            } catch (e) {
                finalTitle = title;
                formattedContent = content;
            }

            modalTitle.textContent = finalTitle;
            modalBody.innerHTML = `<pre>${formattedContent}</pre>`;
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Function to close the modal
        document.getElementById('modalCloseBtn').addEventListener('click', function (e) {
            const modal = document.getElementById('dataModal');
            modal.style.display = 'none';
            document.body.style.overflow = '';
        });

        // Close modal when clicking outside
        document.getElementById('dataModal').addEventListener('click', function (e) {
            if (e.target === this) {
                this.style.display = 'none';
                document.body.style.overflow = '';
            }
        });

        // Function to parse JSON and render structured details for the group table
        function renderGroupDetails() {
            const rawLogData = '{{ test_group_logs|safe|escapejs }}';
            let groupLogs = [];
            try {
                const cleanedRawData = rawLogData.replace(/&quot;/g, '"');
                groupLogs = JSON.parse(cleanedRawData);
            } catch (e) {
                console.warn("Could not parse test_group_logs JSON string.", e);
            }

            groupLogs.forEach(log => {
                const container = document.getElementById(`details-${log.run_id}`);
                if (!container || !log.results_details) return;

                try {
                    let cleanedDetails = log.results_details;
                    if (cleanedDetails.startsWith('"') && cleanedDetails.endsWith('"')) {
                        cleanedDetails = cleanedDetails.slice(1, -1);
                    }

                    const details = JSON.parse(cleanedDetails);

                    const status = details['Overall Status'] || details['overall_status'] || 'N/A';
                    const total = details['Total Tests'] || details['total_tests'] || 'N/A';
                    const failed = details['Failed Tests'] || details['failed_tests'] || 'N/A';
                    const passed = (total !== 'N/A' && failed !== 'N/A') ? (parseInt(total) - parseInt(failed)) : 'N/A';

                    let html = `<div class="results-detail-item">Status: <strong>${status}</strong></div>`;
                    html += `<div class="results-detail-item">Total: <strong>${total}</strong></div>`;

                    if (parseInt(failed) > 0) {
                        html += `<div class="results-detail-item text-red-700">Failed: <strong>${failed}</strong></div>`;
                    } else {
                        html += `<div class="results-detail-item">Failed: <strong>${failed}</strong></div>`;
                    }

                    if (passed !== 'N/A' && parseInt(passed) > 0) {
                        html += `<div class="results-detail-item text-green-700">Passed: <strong>${passed}</strong></div>`;
                    } else if (passed !== 'N/A' && parseInt(passed) === 0) {
                        html += `<div class="results-detail-item">Passed: <strong>${passed}</strong></div>`;
                    }

                    container.innerHTML = html;

                } catch (e) {
                    container.innerHTML = `<div class="results-detail-item text-red-500 italic">Details parse error.</div>`;
                    console.error("Error parsing/rendering details for run_id:", log.run_id, e);
                }
            });
        }

        // Function to parse JSON and render structured details for the PROJECT table
        function renderProjectDetails() {
            const rawLogData = '{{ project_logs|safe|escapejs }}';
            let projectLogs = [];
            try {
                const cleanedRawData = rawLogData.replace(/&quot;/g, '"');
                projectLogs = JSON.parse(cleanedRawData);
            } catch (e) {
                console.warn("Could not parse project_logs JSON string.", e);
            }

            projectLogs.forEach(log => {
                const container = document.getElementById(`project-details-${log.run_id}`);
                if (!container || !log.results_details) return;

                try {
                    let cleanedDetails = log.results_details;
                    if (cleanedDetails.startsWith('"') && cleanedDetails.endsWith('"')) {
                        cleanedDetails = cleanedDetails.slice(1, -1);
                    }

                    const details = JSON.parse(cleanedDetails);

                    const status = details['Overall Status'] || details['overall_status'] || 'N/A';
                    const total = details['Total Groups'] || details['total_groups'] || 'N/A';
                    const failed = details['Failed Groups'] || details['failed_groups'] || 'N/A';
                    const passed = (total !== 'N/A' && failed !== 'N/A') ? (parseInt(total) - parseInt(failed)) : 'N/A';

                    let html = `<div class="results-detail-item">Status: <strong>${status}</strong></div>`;
                    html += `<div class="results-detail-item">Total Groups: <strong>${total}</strong></div>`;

                    if (parseInt(failed) > 0) {
                        html += `<div class="results-detail-item text-red-700">Failed Groups: <strong>${failed}</strong></div>`;
                    } else {
                        html += `<div class="results-detail-item">Failed Groups: <strong>${failed}</strong></div>`;
                    }

                    if (passed !== 'N/A' && parseInt(passed) > 0) {
                        html += `<div class="results-detail-item text-green-700">Passed Groups: <strong>${passed}</strong></div>`;
                    } else if (passed !== 'N/A' && parseInt(passed) === 0) {
                        html += `<div class="results-detail-item">Passed Groups: <strong>${passed}</strong></div>`;
                    }

                    container.innerHTML = html;

                } catch (e) {
                    container.innerHTML = `<div class="results-detail-item text-red-500 italic">Details parse error.</div>`;
                    console.error("Error parsing/rendering project details for run_id:", log.run_id, e);
                }
            });
        }

        // Initialize view based on URL parameter
        document.addEventListener('DOMContentLoaded', function () {
            const caseContent = document.getElementById('tab-case-content');
            const groupContent = document.getElementById('tab-group-content');
            const projectContent = document.getElementById('tab-project-content');

            try {
                const requested = (getUrlParam('tab') || '').toLowerCase();

                if (requested === 'group') {
                    caseContent.style.display = 'none';
                    groupContent.style.display = '';
                    projectContent.style.display = 'none';
                } else if (requested === 'project') {
                    caseContent.style.display = 'none';
                    groupContent.style.display = 'none';
                    projectContent.style.display = '';
                } else {
                    caseContent.style.display = '';
                    groupContent.style.display = 'none';
                    projectContent.style.display = 'none';
                }
            } catch (e) {
                caseContent.style.display = '';
                groupContent.style.display = 'none';
                projectContent.style.display = 'none';
            }

            try {
                renderGroupDetails();
            } catch (e) {
                console.error("Error rendering group details:", e);
            }

            try {
                renderProjectDetails();
            } catch (e) {
                console.error("Error rendering project details:", e);
            }
        });

        // Column resizing, drag-drop reorder, and AUTOFIT on double-click
        (function () {
            let draggedTh = null;
            let dragStartIndex = null;

            // Function to calculate the required width for a column
            function calculateAutofitWidth(table, columnIndex) {
                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.visibility = 'hidden';
                tempDiv.style.whiteSpace = 'nowrap';
                tempDiv.style.fontFamily = 'Inter, sans-serif';
                tempDiv.style.fontSize = '0.8125rem';
                document.body.appendChild(tempDiv);

                let maxWidth = 40;

                const headerCell = table.querySelector('thead tr').children[columnIndex];
                if (headerCell) {
                    tempDiv.textContent = headerCell.textContent.trim();
                    tempDiv.style.fontWeight = '700';
                    maxWidth = Math.max(maxWidth, tempDiv.offsetWidth + 20);
                }

                const rows = table.querySelectorAll('tbody tr');
                rows.forEach(row => {
                    const cell = row.children[columnIndex];
                    if (cell && row.style.display !== 'none') {
                        const isTextXs = cell.classList.contains('text-xs') || cell.querySelector('.query-wrapper') || cell.querySelector('.results-detail-item');
                        tempDiv.style.fontSize = isTextXs ? '0.75rem' : '0.8125rem';
                        tempDiv.style.fontWeight = '400';

                        let contentToMeasure = '';

                        const queryWrapper = cell.querySelector('.query-wrapper');
                        const statusBadge = cell.querySelector('.status-badge');
                        const detailsDisplay = cell.querySelector('.results-details-display');
                        const messageWrapper = cell.querySelector('.message-wrapper');

                        if (queryWrapper) {
                            contentToMeasure = queryWrapper.textContent.trim();
                        } else if (messageWrapper) {
                            contentToMeasure = messageWrapper.textContent.trim();
                        } else if (statusBadge) {
                            contentToMeasure = statusBadge.textContent.trim();
                            tempDiv.style.fontWeight = '600';
                        } else if (detailsDisplay) {
                            tempDiv.style.whiteSpace = 'normal';
                            tempDiv.style.fontSize = '0.75rem';
                            const maxLineLength = Array.from(detailsDisplay.querySelectorAll('.results-detail-item')).reduce((max, item) => {
                                tempDiv.textContent = item.textContent.trim();
                                return Math.max(max, tempDiv.offsetWidth);
                            }, 0);
                            tempDiv.style.whiteSpace = 'nowrap';
                            maxWidth = Math.max(maxWidth, maxLineLength + 20);
                            contentToMeasure = null;
                        } else {
                            contentToMeasure = cell.textContent.trim();
                        }

                        if (contentToMeasure !== null) {
                            tempDiv.textContent = contentToMeasure;
                            const currentContentWidth = tempDiv.offsetWidth + 20;

                            let calculatedWidth;
                            const softCap = 800;

                            if (currentContentWidth > softCap) {
                                calculatedWidth = softCap;
                            } else if (currentContentWidth > 200) {
                                calculatedWidth = currentContentWidth;
                            } else {
                                calculatedWidth = currentContentWidth;
                            }

                            maxWidth = Math.max(maxWidth, calculatedWidth);
                        }
                    }
                });

                document.body.removeChild(tempDiv);
                return Math.max(40, maxWidth);
            }

            ['caseTable', 'groupTable', 'projectTable'].forEach(tableId => {
                const table = document.getElementById(tableId);
                if (!table) return;

                const headerRow = table.querySelector('thead tr');
                const colGroup = table.querySelector('colgroup');

                function loadColumnWidths(tableId, ths, colGroup) {
                    try {
                        const savedWidths = JSON.parse(localStorage.getItem('colWidths_' + tableId) || 'null');
                        if (savedWidths && savedWidths.length === ths.length) {
                            ths.forEach((th, i) => {
                                const width = savedWidths[i];
                                if (width > 40) {
                                    const colElement = colGroup && colGroup.children[i];
                                    if (colElement) {
                                        colElement.style.width = width + 'px';
                                    } else {
                                        th.style.width = width + 'px';
                                    }
                                }
                            });
                        }
                    } catch { }
                }

                function loadColumnOrder(tableId, table) {
                    const savedOrder = JSON.parse(localStorage.getItem('colOrder_' + tableId) || 'null');

                    if (!savedOrder) return;

                    const headerRow = table.querySelector('thead tr');
                    const ths = Array.from(headerRow.children);
                    const currentHeaders = ths.map(th => th.textContent.trim());
                    const colGroup = table.querySelector('colgroup');
                    const colElements = colGroup ? Array.from(colGroup.children) : [];

                    if (savedOrder.length !== currentHeaders.length || savedOrder.some(col => !currentHeaders.includes(col))) {
                        localStorage.removeItem('colOrder_' + tableId);
                        return;
                    }

                    const headerMap = {};
                    const colMap = {};
                    ths.forEach((th, index) => {
                        const headerText = th.textContent.trim();
                        headerMap[headerText] = th;
                        if (colElements[index]) {
                            colMap[headerText] = colElements[index];
                        }
                    });

                    const headerFragment = document.createDocumentFragment();
                    const colFragment = document.createDocumentFragment();

                    savedOrder.forEach((headerText) => {
                        if (headerMap[headerText]) {
                            headerFragment.appendChild(headerMap[headerText]);
                            if (colGroup && colMap[headerText]) {
                                colFragment.appendChild(colMap[headerText]);
                            }
                        }
                    });

                    headerRow.appendChild(headerFragment);
                    if (colGroup) {
                        colGroup.appendChild(colFragment);
                    }

                    const rows = table.querySelectorAll('tbody tr');

                    rows.forEach(row => {
                        const cells = Array.from(row.children);
                        const rowFragment = document.createDocumentFragment();

                        const cellMap = {};
                        currentHeaders.forEach((headerText, idx) => {
                            cellMap[headerText] = cells[idx];
                        });

                        Array.from(headerRow.children).forEach(th => {
                            const headerText = th.textContent.trim();
                            const cellToMove = cellMap[headerText];
                            if (cellToMove) {
                                rowFragment.appendChild(cellToMove);
                            }
                        });

                        row.innerHTML = '';
                        row.appendChild(rowFragment);
                    });
                }

                const initialThs = table.querySelector('thead tr').children;
                loadColumnWidths(tableId, initialThs, colGroup);
                loadColumnOrder(tableId, table);

                const currentThs = table.querySelector('thead tr').children;
                const currentColGroup = table.querySelector('colgroup');

                function saveCurrentWidths() {
                    const widths = Array.from(headerRow.children).map((th, i) => {
                        const col = currentColGroup ? currentColGroup.children[i] : th;
                        return Math.round(col.offsetWidth);
                    });
                    try { localStorage.setItem('colWidths_' + tableId, JSON.stringify(widths)); } catch { }
                }

                Array.from(currentThs).forEach((th, thIndex) => {
                    th.addEventListener('dblclick', e => {
                        e.preventDefault();
                        e.stopPropagation();

                        const currentIndex = Array.from(th.parentNode.children).indexOf(th);
                        const currentCol = currentColGroup ? currentColGroup.children[currentIndex] : th;

                        const autofitWidth = calculateAutofitWidth(table, currentIndex);
                        currentCol.style.width = autofitWidth + 'px';
                        saveCurrentWidths();
                    });

                    if (th.querySelector('.resize-handle')) {
                        const handle = th.querySelector('.resize-handle');
                        let startX, startWidth;

                        handle.addEventListener('mousedown', e => {
                            e.preventDefault();
                            const currentIndex = Array.from(th.parentNode.children).indexOf(th);
                            const currentCol = currentColGroup ? currentColGroup.children[currentIndex] : th;

                            startWidth = currentCol.offsetWidth;
                            startX = e.pageX;

                            document.body.style.userSelect = 'none';
                            document.body.style.cursor = 'col-resize';

                            function onMouseMove(e) {
                                const newWidth = startWidth + (e.pageX - startX);
                                if (newWidth > 40) {
                                    currentCol.style.width = newWidth + 'px';
                                }
                            }

                            function onMouseUp() {
                                saveCurrentWidths();
                                document.removeEventListener('mousemove', onMouseMove);
                                document.removeEventListener('mouseup', onMouseUp);
                                document.body.style.userSelect = '';
                                document.body.style.cursor = '';
                            }

                            document.addEventListener('mousemove', onMouseMove);
                            document.addEventListener('mouseup', onMouseUp);
                        });
                    }

                    th.setAttribute('draggable', true);

                    th.addEventListener('dragenter', () => th.classList.add('border-l-4', 'border-blue-500'));
                    th.addEventListener('dragleave', () => th.classList.remove('border-l-4', 'border-blue-500'));
                    th.addEventListener('drop', () => th.classList.remove('border-l-4', 'border-blue-500'));

                    th.addEventListener('dragstart', e => {
                        draggedTh = th;
                        dragStartIndex = Array.from(th.parentNode.children).indexOf(th);
                        e.dataTransfer.effectAllowed = 'move';
                        e.dataTransfer.setData('text/plain', '');
                        th.style.opacity = '0.5';
                    });

                    th.addEventListener('dragend', () => {
                        draggedTh.style.opacity = '';
                        draggedTh = null;
                        dragStartIndex = null;
                    });

                    th.addEventListener('dragover', e => {
                        e.preventDefault();
                        e.dataTransfer.dropEffect = 'move';
                    });

                    th.addEventListener('drop', e => {
                        e.preventDefault();

                        if (!draggedTh || draggedTh === th) return;

                        const tr = th.parentNode;
                        const dragEndIndex = Array.from(tr.children).indexOf(th);
                        const colGroup = table.querySelector('colgroup');
                        const colToMove = colGroup ? Array.from(colGroup.children)[dragStartIndex] : null;

                        const originalHeaders = Array.from(tr.children).map(th => th.textContent.trim());

                        if (dragEndIndex > dragStartIndex) {
                            tr.insertBefore(draggedTh, tr.children[dragEndIndex + 1] || null);
                            if (colGroup && colToMove) {
                                colGroup.insertBefore(colToMove, colGroup.children[dragEndIndex + 1] || null);
                            }
                        } else {
                            tr.insertBefore(draggedTh, tr.children[dragEndIndex]);
                            if (colGroup && colToMove) {
                                colGroup.insertBefore(colToMove, colGroup.children[dragEndIndex]);
                            }
                        }

                        const newHeaders = Array.from(tr.children).map(th => th.textContent.trim());
                        const rows = table.querySelectorAll('tbody tr');

                        rows.forEach(row => {
                            const cells = Array.from(row.children);
                            const rowFragment = document.createDocumentFragment();

                            const cellMap = {};
                            originalHeaders.forEach((headerText, idx) => {
                                cellMap[headerText] = cells[idx];
                            });

                            newHeaders.forEach(headerText => {
                                const cellToMove = cellMap[headerText];
                                if (cellToMove) {
                                    rowFragment.appendChild(cellToMove);
                                }
                            });

                            row.innerHTML = '';
                            row.appendChild(rowFragment);
                        });

                        try { localStorage.setItem('colOrder_' + tableId, JSON.stringify(newHeaders)); } catch { }
                        saveCurrentWidths();
                        th.classList.remove('border-l-4', 'border-blue-500');
                    });
                });
            });
        })();
    </script>

</body>

</html>